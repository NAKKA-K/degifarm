{% extends "base.html" %}
{% load static %}

{% block head %}
  <link rel="stylesheet" href="{% static 'css/checkbox.css' %}">
{% endblock head %}


{% block file_page %}active{% endblock %}


{% block contents %}

  <div class="jumbotron" style="color:#FFF; background:url({% static 'images/header2.jpg' %}); background-size:1150px 420px;">
    <h1 class="text-center">配布リスト</h1>
  </div>

  <ol class="breadcrumb">
    <li><a href="{% url 'index' %}">ホーム</a></li>
    <li class="active"><a href="#">配布リスト</a></li>
  </ol>


  <div class="row">
    <div class="col-xs-12 col-sm-3">
      <h1 class="page-header text-center" style="font-size:130%;">分類毎はこちらから</h1>
      <ul style="font-size:140%;">
        {% for class in class_list %}
          <li><a href="{% url 'submission_form:dist_category' category_pk=class.id %}"> {{ class.name }}</a></li>
        {% empty %}
          <li><a href="#"></a> 分類がありません</li>
        {% endfor %}
      </ul>
    </div>

  <div class="col-xs-12 col-sm-9">
      <h1 class="page-header">配布物
        {% if is_teacher %}
          <a class="btn btn-default pull-rigth" href="{% url 'submission_form:dist_create' %}">
            <span title="New Dist" class="glyphicon glyphicon-plus"> 配布の追加</span>
          </a>
        {% endif %}
      </h1>

      <table class="table table-hover">
        <thead>
          <tr bgcolor="#000000">
            <th><font color="#FFFFF">分野</th>
            <th><font color="#FFFFF">ファイル名</th>
            <th><font color="#FFFFF">更新日</th>
            <th><font color="#FFFFF">操作</th>
          </tr>
        </thead>
        
        <tbody>

        {% for file in file_list %}
          <tr>
            <td>{{ file.classification_id.name }}</td>
            <td>{{ file.name }}</td>
            <td>{{ file.published_date }}</td>
            <td>
              <a href="{% url 'submission_form:dist_download' pk=file.id %}" class="btn btn-info btn-sm">ダウンロード</a>
              <a href="{% url 'submission_form:dist_delete' pk=file.id %}" class="btn btn-warning btn-sm">削除</a>
              <label><input type="checkbox" name="check" class="checkbox_input" value="{{ file.path }}"><span class="checkbox_parts"></span><label>
            </td>
          </tr>
        {% endfor %}
      </tbody>
      
    </table>

    <div class="text-center">
      <button id="all_download_button" class="btn btn-primary btn-sm">一括ダウンロード</button>
      {% include "submission_form/page.html" %}
    </div>

    <div id="output"></div>

  </div>
{% endblock contents%}


{% block script %}
  <script src="{% static 'js/data-href.js' %}"></script> 

  <script>
    $('#all_download_button').click(function(event){
      event.preventDefault(); //ボタン本来の機能を停止させる関数

      /* チェックされていない */
      if($('[name=check]').prop('checked') == false){
        return;
      }

      /* 選択中のチェックボックスのvalue値を取得 */
      let files_path = []
      $('[name=check]:checked').each(function(){
        files_path.push($(this).val());
      });

      /* URLタグの生成 */
      let link = document.createElement('a');
      link.href = '/submission_form/download/zip/?';

      /* URLパラメータを追加 */
      for(let i = 0; i < files_path.length; i++){
        link.href += 'mydata[]=' + files_path[i] + '&';
      }

      link.click();
    });
  </script>

{% endblock script %}
